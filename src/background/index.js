(()=>{"use strict";class s{constructor(s){this.endTimestamp=null,this.tabSessions=[],this.startTimestamp=s}endSession(s){this.endTimestamp=s}addTabSession(s){this.tabSessions.push(s)}}class e{constructor(s,e){this.endTimestamp=null,this.domain=s,this.startTimestamp=e}endSession(s){this.endTimestamp=s}}class n{static saveMainSession(s){chrome.storage.local.get(["mainSessions"],(e=>{let n=e.mainSessions||[];n.push(s),chrome.storage.local.set({mainSessions:n},(()=>{console.log("MainSession saved:",s)}))}))}static updateMainSession(s){chrome.storage.local.get(["mainSessions"],(e=>{let n=e.mainSessions||[];n.length>0?(n[n.length-1]=s,chrome.storage.local.set({mainSessions:n},(()=>{console.log("MainSession updated:",s)}))):console.error("No MainSessions available to update.")}))}static getMainSessions(s){chrome.storage.local.get(["mainSessions"],(e=>{s(e.mainSessions||[])}))}static clearMainSessions(){chrome.storage.local.set({mainSessions:[]},(()=>{console.log("All MainSessions cleared.")}))}}const i=new class{constructor(){this.currentTabSession=null,this.currentMainSession=null,this.startNewMainSession()}startNewMainSession(){this.currentMainSession=new s((new Date).getTime()),this.currentMainSession&&n.saveMainSession(this.currentMainSession)}startNewTabSession(s){const n=new URL(s.url||"").hostname;this.currentTabSession=new e(n,(new Date).getTime())}endCurrentTabSession(){var s;this.currentTabSession&&(this.currentTabSession.endSession((new Date).getTime()),null===(s=this.currentMainSession)||void 0===s||s.addTabSession(this.currentTabSession),this.currentTabSession=null,this.currentMainSession&&n.updateMainSession(this.currentMainSession))}endCurrentMainSession(){this.currentMainSession&&(this.currentMainSession.endSession((new Date).getTime()),n.updateMainSession(this.currentMainSession))}handleTabActivation(s){this.endCurrentTabSession(),chrome.tabs.get(s,(s=>{this.startNewTabSession(s)}))}handleTabUpdate(s){this.endCurrentTabSession(),chrome.tabs.get(s,(s=>{this.startNewTabSession(s)}))}handleWindowFocusChange(s){this.endCurrentTabSession(),s!==chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({active:!0,currentWindow:!0},(s=>{s[0]&&this.startNewTabSession(s[0])}))}};chrome.tabs.onActivated.addListener((s=>{i.handleTabActivation(s.tabId)})),chrome.tabs.onUpdated.addListener(((s,e)=>{"complete"===e.status&&i.currentTabSession&&i.handleTabUpdate(s)})),chrome.windows.onFocusChanged.addListener((s=>{i.handleWindowFocusChange(s)}))})();