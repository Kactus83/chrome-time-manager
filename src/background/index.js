(()=>{"use strict";class s{constructor(s){this.endTimestamp=null,this.tabSessions=[],this.startTimestamp=s}endSession(s){this.endTimestamp=s}addTabSession(s){this.tabSessions.push(s)}}class e{constructor(s,e){this.endTimestamp=null,this.domain=s,this.startTimestamp=e}endSession(s){this.endTimestamp=s}getDuration(){return this.startTimestamp&&this.endTimestamp?Math.floor((this.endTimestamp-this.startTimestamp)/1e3):0}}class t{static saveMainSession(s){chrome.storage.local.get(["mainSessions"],(e=>{let t=e.mainSessions||[];t.push(s),chrome.storage.local.set({mainSessions:t},(()=>{console.log("MainSession saved:",s)}))}))}static getMainSessions(s){chrome.storage.local.get(["mainSessions"],(e=>{s(e.mainSessions||[])}))}static clearMainSessions(){chrome.storage.local.set({mainSessions:[]},(()=>{console.log("All MainSessions cleared.")}))}}const n=new class{constructor(){this.currentTabSession=null,this.currentMainSession=null,this.startNewMainSession()}startNewMainSession(){this.currentMainSession=new s((new Date).getTime())}startNewTabSession(s){const t=new URL(s.url||"").hostname;this.currentTabSession=new e(t,(new Date).getTime())}endCurrentTabSession(){var s;this.currentTabSession&&(this.currentTabSession.endSession((new Date).getTime()),null===(s=this.currentMainSession)||void 0===s||s.addTabSession(this.currentTabSession),this.currentTabSession=null)}endCurrentMainSession(){this.currentMainSession&&(this.currentMainSession.endSession((new Date).getTime()),t.saveMainSession(this.currentMainSession),this.startNewMainSession())}handleTabActivation(s){this.endCurrentTabSession(),chrome.tabs.get(s,(s=>{this.startNewTabSession(s)}))}handleTabUpdate(s){this.endCurrentTabSession(),chrome.tabs.get(s,(s=>{this.startNewTabSession(s)}))}handleWindowFocusChange(s){this.endCurrentTabSession(),s!==chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({active:!0,currentWindow:!0},(s=>{s[0]&&this.startNewTabSession(s[0])}))}};chrome.tabs.onActivated.addListener((s=>{n.handleTabActivation(s.tabId)})),chrome.tabs.onUpdated.addListener(((s,e)=>{"complete"===e.status&&n.currentTabSession&&n.handleTabUpdate(s)})),chrome.windows.onFocusChanged.addListener((s=>{n.handleWindowFocusChange(s)}))})();